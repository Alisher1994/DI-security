<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–°–∏—Å—Ç–µ–º–∞ –û—Ö—Ä–∞–Ω—ã - –°–æ—Ç—Ä—É–¥–Ω–∏–∫</title>
    <link rel="stylesheet" href="/css/employee.css">
    <script src="https://api-maps.yandex.ru/2.1/?apikey=&lang=ru_RU" type="text/javascript"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>

<body>
    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <div class="logo">
                <div class="shield-icon">üõ°Ô∏è</div>
                <h1>–°–∏—Å—Ç–µ–º–∞ –û—Ö—Ä–∞–Ω—ã</h1>
            </div>
            <form id="login-form" class="login-form">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" required autocomplete="email">
                </div>
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="password" name="password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary">–í–æ–π—Ç–∏</button>
                <div id="login-error" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="main-screen" class="screen">
        <!-- Header -->
        <header class="app-header">
            <div class="header-content">
                <div class="user-info">
                    <div class="user-avatar">
                        <span id="user-initials">üë§</span>
                    </div>
                    <div class="user-details">
                        <div id="user-name" class="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        <div id="user-role" class="user-role"></div>
                    </div>
                </div>
                <button id="logout-btn" class="btn-icon" title="–í—ã–π—Ç–∏">
                    <span>üö™</span>
                </button>
            </div>
        </header>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–º–µ–Ω–µ -->
        <section class="shift-info">
            <div id="no-shift" class="alert alert-warning">
                <span class="alert-icon">‚ö†Ô∏è</span>
                <div>
                    <div class="alert-title">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω—ã</div>
                    <div class="alert-text">–£ –≤–∞—Å —Å–µ–π—á–∞—Å –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–º–µ–Ω—ã</div>
                </div>
            </div>
            <div id="active-shift" class="shift-card" style="display: none;">
                <div class="shift-header-minimal">
                    <div class="status-indicator">
                        <span class="status-dot-small"></span>
                        <span class="status-label-small">–ê–∫—Ç–∏–≤–Ω–∞—è</span>
                    </div>
                    <div class="shift-times-row">
                        <span id="shift-start">08:00</span> ‚Äî <span id="shift-end">20:00</span>
                    </div>
                </div>
                <div class="shift-footer">
                    <span id="shift-time-remaining" class="shift-time-low"></span>
                </div>
            </div>
        </section>

        <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ç—Ä—É–ª–µ–º (—Ç–æ–ª—å–∫–æ –¥–ª—è patrol) -->
        <section id="patrol-controls" class="patrol-controls" style="display: none;">
            <div class="control-card">
                <h2 class="section-title">–ü–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
                <div id="session-inactive" class="session-state">
                    <div class="session-icon">üö∂</div>
                    <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –Ω–∞—á–∞–ª–∞ –ø–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                    <button id="start-patrol-btn" class="btn btn-success btn-large">
                        <span class="btn-icon">‚ñ∂Ô∏è</span>
                        <span>–ù–∞—á–∞—Ç—å –ø–∞—Ç—Ä—É–ª—å</span>
                    </button>
                </div>
                <div id="session-active" class="session-state" style="display: none;">
                    <div class="session-icon active">üèÉ</div>
                    <p>–ü–∞—Ç—Ä—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ</p>
                    <div class="session-stats">
                        <div class="stat-item">
                            <div class="stat-label">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</div>
                            <div id="session-duration" class="stat-value">00:00:00</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</div>
                            <div id="session-scans" class="stat-value">0</div>
                        </div>
                    </div>
                    <button id="stop-patrol-btn" class="btn btn-danger btn-large">
                        <span class="btn-icon">‚èπÔ∏è</span>
                        <span>–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–∞—Ç—Ä—É–ª—å</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- QR Scanner -->
        <section class="scanner-section">
            <div class="control-card">
                <h2 class="section-title">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞</h2>
                <button id="scan-qr-btn" class="btn btn-primary btn-large" disabled>
                    <span class="btn-icon">üì∑</span>
                    <span>–û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥</span>
                </button>
                <div id="scan-result" class="scan-result"></div>
            </div>
        </section>

        <!-- –ö–∞—Ä—Ç–∞ (–¥–ª—è patrol) -->
        <section id="map-section" class="map-section" style="display: none;">
            <div class="control-card">
                <h2 class="section-title">–ú–æ—è –ø–æ–∑–∏—Ü–∏—è</h2>
                <div id="map" class="map-container"></div>
                <div class="location-info">
                    <div class="location-item">
                        <span class="label">GPS —Ç–æ—á–Ω–æ—Å—Ç—å:</span>
                        <span id="gps-accuracy" class="value">--</span>
                    </div>
                    <div class="location-item">
                        <span class="label">–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:</span>
                        <span id="last-update" class="value">--</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- –ò—Å—Ç–æ—Ä–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π -->
        <section class="history-section">
            <div class="control-card">
                <h2 class="section-title">–ò—Å—Ç–æ—Ä–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h2>
                <div id="scan-history" class="scan-history"></div>
            </div>
        </section>

        <!-- –†–∞—Ü–∏—è (Walkie-Talkie) -->
        <section class="radio-section">
            <div class="control-card">
                <div class="section-header">
                    <h2 class="section-title">–†–∞—Ü–∏—è (PTT)</h2>
                    <div id="radio-online-status" class="online-status">
                        <span class="status-dot"></span> <span id="radio-status-text">–û—Ñ—Ñ–ª–∞–π–Ω</span>
                    </div>
                </div>

                <div class="radio-controls">
                    <div class="form-group">
                        <label>–ö–∞–Ω–∞–ª –≤–µ—â–∞–Ω–∏—è</label>
                        <select id="radio-channel" class="input-select">
                            <option value="general">–û–±—â–∏–π –∫–∞–Ω–∞–ª</option>
                            <option value="kpp">–ö–ü–ü</option>
                            <option value="patrol">–ü–∞—Ç—Ä—É–ª—å–Ω—ã–µ</option>
                            <option value="emergency">–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π</option>
                        </select>
                    </div>

                    <div id="radio-display" class="radio-display">
                        <div id="radio-incoming" class="incoming-info" style="display: none;">
                            <span class="wave-icon">üîä</span>
                            –ì–æ–≤–æ—Ä–∏—Ç: <span id="radio-sender-name">...</span>
                        </div>
                        <div id="radio-idle" class="idle-info">
                            –ö–∞–Ω–∞–ª —Å–≤–æ–±–æ–¥–µ–Ω
                        </div>
                    </div>

                    <div class="ptt-container">
                        <button id="ptt-button" class="ptt-button" disabled oncontextmenu="return false;">
                            <div class="ptt-inner">
                                <span class="ptt-icon">üéôÔ∏è</span>
                                <span class="ptt-text">–ó–ê–ñ–ú–ò–¢–ï –ß–¢–û–ë–´ –ì–û–í–û–†–ò–¢–¨</span>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- QR Scanner Modal -->
    <div id="qr-scanner-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR-–∫–æ–¥–∞</h2>
                <button class="modal-close" id="close-scanner">‚úï</button>
            </div>
            <div class="modal-body">
                <div id="qr-reader"></div>
                <div class="manual-input">
                    <p>–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –≤—Ä—É—á–Ω—É—é:</p>
                    <input type="text" id="manual-qr-input" placeholder="–í–≤–µ–¥–∏—Ç–µ QR-–∫–æ–¥">
                    <button id="manual-qr-submit" class="btn btn-secondary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/employee-app.js"></script>
</body>

</html>